<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Running Zig binaries on a KaiOS device | Roger&#39;s blog</title>
<meta name="keywords" content="">
<meta name="description" content="The goal here is to:
Cross-compile a Zig program Root a KaiOS device, and then install and run the cross-compiled program on the device We&rsquo;re not making a GUI app or anything here, just a small &ldquo;Hello world&rdquo; program that we&rsquo;ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.
I&rsquo;m using Android&rsquo;s adb to push files to the device and to get a shell, so you&rsquo;ll have to install that first if you wanna follow along.">
<meta name="author" content="">
<link rel="canonical" href="https://cryptocode.github.io/blog/docs/kaios/">
<link crossorigin="anonymous" href="/blog/assets/css/stylesheet.477c66c7b447db15333d0dde413a631316108b717f7eb1a1c64f64374ef55b3d.css" integrity="sha256-R3xmx7RH2xUzPQ3eQTpjExYQi3F/frGhxk9kN071Wz0=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/blog/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://cryptocode.github.io/blog/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://cryptocode.github.io/blog/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://cryptocode.github.io/blog/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://cryptocode.github.io/blog/apple-touch-icon.png">
<link rel="mask-icon" href="https://cryptocode.github.io/blog/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><meta property="og:title" content="Running Zig binaries on a KaiOS device" />
<meta property="og:description" content="The goal here is to:
Cross-compile a Zig program Root a KaiOS device, and then install and run the cross-compiled program on the device We&rsquo;re not making a GUI app or anything here, just a small &ldquo;Hello world&rdquo; program that we&rsquo;ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.
I&rsquo;m using Android&rsquo;s adb to push files to the device and to get a shell, so you&rsquo;ll have to install that first if you wanna follow along." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cryptocode.github.io/blog/docs/kaios/" /><meta property="article:section" content="docs" />
<meta property="article:published_time" content="2021-01-27T10:00:00+02:00" />
<meta property="article:modified_time" content="2021-01-27T10:00:00+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Running Zig binaries on a KaiOS device"/>
<meta name="twitter:description" content="The goal here is to:
Cross-compile a Zig program Root a KaiOS device, and then install and run the cross-compiled program on the device We&rsquo;re not making a GUI app or anything here, just a small &ldquo;Hello world&rdquo; program that we&rsquo;ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.
I&rsquo;m using Android&rsquo;s adb to push files to the device and to get a shell, so you&rsquo;ll have to install that first if you wanna follow along."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Docs",
      "item": "https://cryptocode.github.io/blog/docs/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Running Zig binaries on a KaiOS device",
      "item": "https://cryptocode.github.io/blog/docs/kaios/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Running Zig binaries on a KaiOS device",
  "name": "Running Zig binaries on a KaiOS device",
  "description": "The goal here is to:\nCross-compile a Zig program Root a KaiOS device, and then install and run the cross-compiled program on the device We\u0026rsquo;re not making a GUI app or anything here, just a small \u0026ldquo;Hello world\u0026rdquo; program that we\u0026rsquo;ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.\nI\u0026rsquo;m using Android\u0026rsquo;s adb to push files to the device and to get a shell, so you\u0026rsquo;ll have to install that first if you wanna follow along.",
  "keywords": [
    
  ],
  "articleBody": "The goal here is to:\nCross-compile a Zig program Root a KaiOS device, and then install and run the cross-compiled program on the device We’re not making a GUI app or anything here, just a small “Hello world” program that we’ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.\nI’m using Android’s adb to push files to the device and to get a shell, so you’ll have to install that first if you wanna follow along.\nMake a Hello World program in Zig const std = @import(\"std\"); pub fn main() !void { const stdout = std.io.getStdOut().writer(); try stdout.print(\"Hello from Zig!\\n\", .{}); } Save as main.zig\nCross-compile Zig makes it trivial to cross-compile for the ARM Cortex A7:\nzig build-exe -target arm-linux-musleabihf -femit-bin=zigapp main.zig Root the device The recipe here is going to be different for each device type. I’m using a Nokia 2720 Flip for testing, which is easy to root with wallace-light:\nNOTE: I used OmniSD to perform a priviledged reset long before making this post. I’m not sure if it’s necessary or not for Wallace Light to work. If the recipe below doesn’t work, try installing OmniSD and do a reset; it’s easy enough [2].\nPut your KaiOS device in debug mode, typically using *#*#33284#*#* (which spells debug - a bug icon should appear in the status line if it works)\nDeploy Wallace Light [1]\nadb forward tcp:6000 localfilesystem:/data/local/debugger-socket npm i -g @filipe_x3/kdeploy kdeploy -i ~/Downloads/wallace-lite-0.1/application Now start Wallace Light on the device and click ROOT ME.\nNext, I’m pushing the cross-compiled Zig binary to the device’s sdcard:\nadb push zigapp /sdcard Now we need to jump into the device through a shell:\nadb shell We’re now in a terminal session on the device, but most likely on a read-only file system. Let’s fix that:\nmount -o rw,remount /system Next, move the binary from /sdcard to /system/bin and make it executable:\ncp /sdcard/zigapp /system/bin chmod +x /system/bin/zigapp Now we can run it!\n/system/bin/zigapp Result as expected:\nHello from Zig! [1] I used Wallace Light from https://sites.google.com/view/bananahackers/root/temporary-root#h.sb1y1p9fj906\nUnzip it, then unzip the contained application.zip, which is what we’re deploying above.\n[2] https://sites.google.com/view/bananahackers/install-omnisd\n",
  "wordCount" : "363",
  "inLanguage": "en",
  "datePublished": "2021-01-27T10:00:00+02:00",
  "dateModified": "2021-01-27T10:00:00+02:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://cryptocode.github.io/blog/docs/kaios/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Roger's blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://cryptocode.github.io/blog/favicon.ico"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://cryptocode.github.io/blog/" accesskey="h" title="Roger&#39;s blog (Alt + H)">Roger&#39;s blog</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title">
      Running Zig binaries on a KaiOS device
    </h1>
    <div class="post-meta"><span title='2021-01-27 10:00:00 +0200 +0200'>January 27, 2021</span>

</div>
  </header> 
  <div class="post-content"><p>The goal here is to:</p>
<ul>
<li>Cross-compile a Zig program</li>
<li>Root a KaiOS device, and then install and run the cross-compiled program on the device</li>
</ul>
<p>We&rsquo;re not making a GUI app or anything here, just a small &ldquo;Hello world&rdquo; program that we&rsquo;ll cross-compile and run on the device. All sorts of interesting things can be done from this point on.</p>
<p>I&rsquo;m using Android&rsquo;s <code>adb</code> to push files to the device and to get a shell, so you&rsquo;ll have to install that first if you wanna follow along.</p>
<h2 id="make-a-hello-world-program-in-zig">Make a Hello World program in Zig<a hidden class="anchor" aria-hidden="true" href="#make-a-hello-world-program-in-zig">#</a></h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> std <span style="color:#f92672">=</span> @import(<span style="color:#e6db74">&#34;std&#34;</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">pub</span> <span style="color:#66d9ef">fn</span> main() <span style="color:#f92672">!</span><span style="color:#66d9ef">void</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">const</span> stdout <span style="color:#f92672">=</span> std.io.getStdOut().writer();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> stdout.print(<span style="color:#e6db74">&#34;Hello from Zig!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, .{});
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Save as <code>main.zig</code></p>
<h2 id="cross-compile">Cross-compile<a hidden class="anchor" aria-hidden="true" href="#cross-compile">#</a></h2>
<p>Zig makes it trivial to cross-compile for the ARM Cortex A7:</p>
<pre tabindex="0"><code>zig build-exe -target arm-linux-musleabihf -femit-bin=zigapp main.zig
</code></pre><h2 id="root-the-device">Root the device<a hidden class="anchor" aria-hidden="true" href="#root-the-device">#</a></h2>
<p>The recipe here is going to be different for each device type. I&rsquo;m using a Nokia 2720 Flip for testing, which is easy to root with <code>wallace-light</code>:</p>
<p><em>NOTE: I used OmniSD to perform a priviledged reset long before making this post. I&rsquo;m not sure if it&rsquo;s necessary or not for Wallace Light to work. If the recipe below doesn&rsquo;t work, try installing OmniSD and do a reset; it&rsquo;s easy enough [2].</em></p>
<ol>
<li>
<p>Put your KaiOS device in debug mode, typically using <code>*#*#33284#*#*</code> (which spells debug - a bug icon should appear in the status line if it works)</p>
</li>
<li>
<p>Deploy Wallace Light [1]</p>
</li>
</ol>
<pre tabindex="0"><code>adb forward tcp:6000 localfilesystem:/data/local/debugger-socket
npm i -g @filipe_x3/kdeploy
kdeploy -i ~/Downloads/wallace-lite-0.1/application
</code></pre><p>Now start Wallace Light on the device and click ROOT ME.</p>
<p>Next, I&rsquo;m pushing the cross-compiled Zig binary to the device&rsquo;s sdcard:</p>
<pre tabindex="0"><code>adb push zigapp /sdcard
</code></pre><p>Now we need to jump into the device through a shell:</p>
<pre tabindex="0"><code>adb shell
</code></pre><p>We&rsquo;re now in a terminal session on the device, but most likely on a read-only file system. Let&rsquo;s fix that:</p>
<pre tabindex="0"><code>mount -o rw,remount /system
</code></pre><p>Next, move the binary from <code>/sdcard</code> to <code>/system/bin</code> and make it executable:</p>
<pre tabindex="0"><code>cp /sdcard/zigapp /system/bin
chmod +x /system/bin/zigapp
</code></pre><p>Now we can run it!</p>
<pre tabindex="0"><code>/system/bin/zigapp
</code></pre><p>Result as expected:</p>
<pre tabindex="0"><code>Hello from Zig!
</code></pre><p>[1] I used Wallace Light from <a href="https://sites.google.com/view/bananahackers/root/temporary-root#h.sb1y1p9fj906">https://sites.google.com/view/bananahackers/root/temporary-root#h.sb1y1p9fj906</a></p>
<p>Unzip it, then unzip the contained application.zip, which is what we&rsquo;re deploying above.</p>
<p>[2] <a href="https://sites.google.com/view/bananahackers/install-omnisd">https://sites.google.com/view/bananahackers/install-omnisd</a></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
     </body>

</html>
